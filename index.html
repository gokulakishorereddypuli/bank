<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Todo with Notifications</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 2rem auto; padding: 0 1rem; line-height: 1.6; }
        .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        input, button { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        button { background-color: #2563eb; color: white; cursor: pointer; border: none; }
        button:hover { background-color: #1d4ed8; }
        .task-item { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .status { font-size: 0.8rem; padding: 2px 6px; border-radius: 10px; background: #e5e7eb; }
    </style>
</head>
<body>

    <h2>Task Scheduler</h2>
    
    <div class="input-group">
        <input type="text" id="taskName" placeholder="Task description...">
        <input type="datetime-local" id="taskTime">
        <button onclick="addTask()">Add Task</button>
    </div>

    <div id="taskList"></div>

    <script>
        let tasks = [];

        // Request notification permission on load
        window.onload = () => {
            if ("Notification" in window) {
                Notification.requestPermission();
            }
        };

        function addTask() {
            const name = document.getElementById('taskName').value;
            const time = document.getElementById('taskTime').value;

            if (!name || !time) return alert("Please fill in both fields");

            const task = {
                id: Date.now(),
                name,
                startTime: new Date(time).getTime(),
                notified: false
            };

            tasks.push(task);
            renderTasks();
            document.getElementById('taskName').value = '';
        }

        function renderTasks() {
            const list = document.getElementById('taskList');
            list.innerHTML = tasks.map(t => `
                <div class="task-item">
                    <div>
                        <strong>${t.name}</strong><br>
                        <small>${new Date(t.startTime).toLocaleString()}</small>
                    </div>
                    <span class="status">Pending</span>
                </div>
            `).join('');
        }

        // Core logic: Check tasks every second
        setInterval(() => {
            const now = Date.now();

            tasks.forEach(task => {
                const timeLeft = task.startTime - now;
                const tenMinutesInMs = 10 * 60 * 1000;

                // Trigger notification when within the 10-minute window
                if (timeLeft <= tenMinutesInMs && timeLeft > 0) {
                    showCountdownNotification(task, timeLeft);
                }
            });
        }, 1000);

        function showCountdownNotification(task, timeLeft) {
            if (Notification.permission !== "granted") return;

            const secondsTotal = Math.floor(timeLeft / 1000);
            const mins = Math.floor(secondsTotal / 60);
            const secs = secondsTotal % 60;
            
            const timeString = `${mins}m ${secs}s`;

            // Using a unique tag per task prevents multiple notifications 
            // from stacking for the same task; it updates the existing one instead.
            const options = {
                body: `Starts in: ${timeString}`,
                tag: `task-${task.id}`, 
                renotify: false, // Set to true if you want it to vibrate/sound every second (not recommended)
                silent: true     // Keep it quiet since it updates every second
            };

            new Notification(`Upcoming Task: ${task.name}`, options);
        }
    </script>
</body>
</html>
